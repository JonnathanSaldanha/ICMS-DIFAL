<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora DIFAL - Cálculo de ICMS Diferencial</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .calculator-section, .upload-section, .tables-section {
            padding: 30px;
            border-bottom: 1px solid #eee;
        }

        h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #34495e;
        }

        select, input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #3498db;
        }

        .btn-calculate {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: transform 0.2s;
        }

        .btn-calculate:hover {
            transform: translateY(-2px);
        }

        .resultado, .isencao {
            margin-top: 25px;
            padding: 20px;
            border-radius: 10px;
            animation: slideDown 0.3s ease;
        }

        .resultado {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border: 2px solid #28a745;
        }

        .isencao {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border: 2px solid #ffc107;
        }

        .resultado h3, .isencao h3 {
            color: #155724;
            margin-bottom: 15px;
        }

        .detalhes-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 8px 0;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }

        .detalhes-total {
            font-weight: bold;
            font-size: 1.2em;
            color: #155724;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 2px solid #28a745;
        }

        .upload-area {
            border: 3px dashed #3498db;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
        }

        .upload-area:hover {
            background: #f8f9fa;
            border-color: #2980b9;
        }

        .upload-area input {
            display: none;
        }

        .upload-placeholder {
            color: #7f8c8d;
            font-size: 1.1em;
        }

        .lista-arquivos {
            margin-top: 20px;
        }

        .arquivo-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }

        .tables-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .table-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #dee2e6;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        th {
            background: #34495e;
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background: #e9ecef;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .tables-container {
                grid-template-columns: 1fr;
            }
            
            .container {
                margin: 10px;
                border-radius: 10px;
            }
            
            header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>🧮 Calculadora DIFAL</h1>
            <p>Cálculo automático do diferencial de alíquota do ICMS</p>
        </header>

        <div class="calculator-section">
            <h2>Calculadora Manual</h2>
            
            <div class="form-group">
                <label for="ufOrigem">UF de Origem:</label>
                <select id="ufOrigem">
                    <option value="">Selecione...</option>
                </select>
            </div>

            <div class="form-group">
                <label for="ufDestino">UF de Destino:</label>
                <select id="ufDestino">
                    <option value="">Selecione...</option>
                </select>
            </div>

            <div class="form-group">
                <label for="tipoDestinatario">Tipo de Destinatário:</label>
                <select id="tipoDestinatario">
                    <option value="consumidor">Consumidor Final (Pessoa Física)</option>
                    <option value="simples">Empresa Simples Nacional</option>
                    <option value="contribuinte">Contribuinte do ICMS</option>
                </select>
            </div>

            <div class="form-group">
                <label for="valorOperacao">Valor da Operação (R$):</label>
                <input type="number" id="valorOperacao" step="0.01" placeholder="0,00">
            </div>

            <div class="form-group">
                <label for="ncm">NCM (Opcional):</label>
                <input type="text" id="ncm" placeholder="Ex: 8517.12.00">
            </div>

            <button onclick="calcularDIFAL()" class="btn-calculate">Calcular DIFAL</button>

            <div id="resultado" class="resultado" style="display: none;">
                <h3>Resultado do Cálculo</h3>
                <div id="detalhesCalculo"></div>
            </div>

            <div id="isencao" class="isencao" style="display: none;">
                <h3>⚠️ DIFAL Não Aplicável</h3>
                <p id="motivoIsencao"></p>
            </div>
        </div>

        <div class="upload-section">
            <h2>Importar NFes (XML)</h2>
            <div class="upload-area" id="uploadArea">
                <input type="file" id="xmlUpload" accept=".xml" multiple>
                <div class="upload-placeholder">
                    <span>📁 Arraste XMLs aqui ou clique para selecionar</span>
                </div>
            </div>
            <div id="listaArquivos" class="lista-arquivos"></div>
        </div>

        <div class="tables-section">
            <h2>Tabelas de Alíquotas</h2>
            <div class="tables-container">
                <div class="table-card">
                    <h3>Alíquotas Interestaduais (%)</h3>
                    <div id="tabelaInterestadual"></div>
                </div>
                <div class="table-card">
                    <h3>Alíquotas Internas por UF (%)</h3>
                    <div id="tabelaInterna"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Banco de dados de alíquotas
        const aliquotasInterestaduais = {
            'SP': { 'MG': 12, 'RJ': 12, 'ES': 12, 'RS': 12, 'PR': 12, 'SC': 12, 'DF': 12, 'GO': 12, 'MT': 12, 'MS': 12, 'AC': 7, 'AL': 7, 'AM': 7, 'AP': 7, 'BA': 7, 'CE': 7, 'MA': 7, 'PA': 7, 'PB': 7, 'PE': 7, 'PI': 7, 'RN': 7, 'RO': 7, 'RR': 7, 'SE': 7, 'TO': 7 },
            'MG': { 'SP': 12, 'RJ': 12, 'ES': 12, 'RS': 12, 'PR': 12, 'SC': 12, 'DF': 12, 'GO': 12, 'MT': 12, 'MS': 12, 'AC': 7, 'AL': 7, 'AM': 7, 'AP': 7, 'BA': 7, 'CE': 7, 'MA': 7, 'PA': 7, 'PB': 7, 'PE': 7, 'PI': 7, 'RN': 7, 'RO': 7, 'RR': 7, 'SE': 7, 'TO': 7 },
            'RJ': { 'SP': 12, 'MG': 12, 'ES': 12, 'RS': 12, 'PR': 12, 'SC': 12, 'DF': 12, 'GO': 12, 'MT': 12, 'MS': 12, 'AC': 7, 'AL': 7, 'AM': 7, 'AP': 7, 'BA': 7, 'CE': 7, 'MA': 7, 'PA': 7, 'PB': 7, 'PE': 7, 'PI': 7, 'RN': 7, 'RO': 7, 'RR': 7, 'SE': 7, 'TO': 7 },
            'RS': { 'SP': 12, 'MG': 12, 'RJ': 12, 'ES': 12, 'PR': 12, 'SC': 12, 'DF': 12, 'GO': 12, 'MT': 12, 'MS': 12, 'AC': 7, 'AL': 7, 'AM': 7, 'AP': 7, 'BA': 7, 'CE': 7, 'MA': 7, 'PA': 7, 'PB': 7, 'PE': 7, 'PI': 7, 'RN': 7, 'RO': 7, 'RR': 7, 'SE': 7, 'TO': 7 },
            'PR': { 'SP': 12, 'MG': 12, 'RJ': 12, 'ES': 12, 'RS': 12, 'SC': 12, 'DF': 12, 'GO': 12, 'MT': 12, 'MS': 12, 'AC': 7, 'AL': 7, 'AM': 7, 'AP': 7, 'BA': 7, 'CE': 7, 'MA': 7, 'PA': 7, 'PB': 7, 'PE': 7, 'PI': 7, 'RN': 7, 'RO': 7, 'RR': 7, 'SE': 7, 'TO': 7 },
            'SC': { 'SP': 12, 'MG': 12, 'RJ': 12, 'ES': 12, 'RS': 12, 'PR': 12, 'DF': 12, 'GO': 12, 'MT': 12, 'MS': 12, 'AC': 7, 'AL': 7, 'AM': 7, 'AP': 7, 'BA': 7, 'CE': 7, 'MA': 7, 'PA': 7, 'PB': 7, 'PE': 7, 'PI': 7, 'RN': 7, 'RO': 7, 'RR': 7, 'SE': 7, 'TO': 7 },
            'ES': { 'SP': 12, 'MG': 12, 'RJ': 12, 'RS': 12, 'PR': 12, 'SC': 12, 'DF': 12, 'GO': 12, 'MT': 12, 'MS': 12, 'AC': 7, 'AL': 7, 'AM': 7, 'AP': 7, 'BA': 7, 'CE': 7, 'MA': 7, 'PA': 7, 'PB': 7, 'PE': 7, 'PI': 7, 'RN': 7, 'RO': 7, 'RR': 7, 'SE': 7, 'TO': 7 },
            'DF': { 'SP': 12, 'MG': 12, 'RJ': 12, 'ES': 12, 'RS': 12, 'PR': 12, 'SC': 12, 'GO': 12, 'MT': 12, 'MS': 12, 'AC': 7, 'AL': 7, 'AM': 7, 'AP': 7, 'BA': 7, 'CE': 7, 'MA': 7, 'PA': 7, 'PB': 7, 'PE': 7, 'PI': 7, 'RN': 7, 'RO': 7, 'RR': 7, 'SE': 7, 'TO': 7 },
            'GO': { 'SP': 12, 'MG': 12, 'RJ': 12, 'ES': 12, 'RS': 12, 'PR': 12, 'SC': 12, 'DF': 12, 'MT': 12, 'MS': 12, 'AC': 7, 'AL': 7, 'AM': 7, 'AP': 7, 'BA': 7, 'CE': 7, 'MA': 7, 'PA': 7, 'PB': 7, 'PE': 7, 'PI': 7, 'RN': 7, 'RO': 7, 'RR': 7, 'SE': 7, 'TO': 7 },
            'MT': { 'SP': 12, 'MG': 12, 'RJ': 12, 'ES': 12, 'RS': 12, 'PR': 12, 'SC': 12, 'DF': 12, 'GO': 12, 'MS': 12, 'AC': 7, 'AL': 7, 'AM': 7, 'AP': 7, 'BA': 7, 'CE': 7, 'MA': 7, 'PA': 7, 'PB': 7, 'PE': 7, 'PI': 7, 'RN': 7, 'RO': 7, 'RR': 7, 'SE': 7, 'TO': 7 },
            'MS': { 'SP': 12, 'MG': 12, 'RJ': 12, 'ES': 12, 'RS': 12, 'PR': 12, 'SC': 12, 'DF': 12, 'GO': 12, 'MT': 12, 'AC': 7, 'AL': 7, 'AM': 7, 'AP': 7, 'BA': 7, 'CE': 7, 'MA': 7, 'PA': 7, 'PB': 7, 'PE': 7, 'PI': 7, 'RN': 7, 'RO': 7, 'RR': 7, 'SE': 7, 'TO': 7 },
            'AC': { 'SP': 7, 'MG': 7, 'RJ': 7, 'ES': 7, 'RS': 7, 'PR': 7, 'SC': 7, 'DF': 7, 'GO': 7, 'MT': 7, 'MS': 7, 'AL': 7, 'AM': 7, 'AP': 7, 'BA': 7, 'CE': 7, 'MA': 7, 'PA': 7, 'PB': 7, 'PE': 7, 'PI': 7, 'RN': 7, 'RO': 7, 'RR': 7, 'SE': 7, 'TO': 7 },
            'AL': { 'SP': 7, 'MG': 7, 'RJ': 7, 'ES': 7, 'RS': 7, 'PR': 7, 'SC': 7, 'DF': 7, 'GO': 7, 'MT': 7, 'MS': 7, 'AC': 7, 'AM': 7, 'AP': 7, 'BA': 7, 'CE': 7, 'MA': 7, 'PA': 7, 'PB': 7, 'PE': 7, 'PI': 7, 'RN': 7, 'RO': 7, 'RR': 7, 'SE': 7, 'TO': 7 },
            'AM': { 'SP': 7, 'MG': 7, 'RJ': 7, 'ES': 7, 'RS': 7, 'PR': 7, 'SC': 7, 'DF': 7, 'GO': 7, 'MT': 7, 'MS': 7, 'AC': 7, 'AL': 7, 'AP': 7, 'BA': 7, 'CE': 7, 'MA': 7, 'PA': 7, 'PB': 7, 'PE': 7, 'PI': 7, 'RN': 7, 'RO': 7, 'RR': 7, 'SE': 7, 'TO': 7 },
            'AP': { 'SP': 7, 'MG': 7, 'RJ': 7, 'ES': 7, 'RS': 7, 'PR': 7, 'SC': 7, 'DF': 7, 'GO': 7, 'MT': 7, 'MS': 7, 'AC': 7, 'AL': 7, 'AM': 7, 'BA': 7, 'CE': 7, 'MA': 7, 'PA': 7, 'PB': 7, 'PE': 7, 'PI': 7, 'RN': 7, 'RO': 7, 'RR': 7, 'SE': 7, 'TO': 7 },
            'BA': { 'SP': 7, 'MG': 7, 'RJ': 7, 'ES': 7, 'RS': 7, 'PR': 7, 'SC': 7, 'DF': 7, 'GO': 7, 'MT': 7, 'MS': 7, 'AC': 7, 'AL': 7, 'AM': 7, 'AP': 7, 'CE': 7, 'MA': 7, 'PA': 7, 'PB': 7, 'PE': 7, 'PI': 7, 'RN': 7, 'RO': 7, 'RR': 7, 'SE': 7, 'TO': 7 },
            'CE': { 'SP': 7, 'MG': 7, 'RJ': 7, 'ES': 7, 'RS': 7, 'PR': 7, 'SC': 7, 'DF': 7, 'GO': 7, 'MT': 7, 'MS': 7, 'AC': 7, 'AL': 7, 'AM': 7, 'AP': 7, 'BA': 7, 'MA': 7, 'PA': 7, 'PB': 7, 'PE': 7, 'PI': 7, 'RN': 7, 'RO': 7, 'RR': 7, 'SE': 7, 'TO': 7 },
            'MA': { 'SP': 7, 'MG': 7, 'RJ': 7, 'ES': 7, 'RS': 7, 'PR': 7, 'SC': 7, 'DF': 7, 'GO': 7, 'MT': 7, 'MS': 7, 'AC': 7, 'AL': 7, 'AM': 7, 'AP': 7, 'BA': 7, 'CE': 7, 'PA': 7, 'PB': 7, 'PE': 7, 'PI': 7, 'RN': 7, 'RO': 7, 'RR': 7, 'SE': 7, 'TO': 7 },
            'PA': { 'SP': 7, 'MG': 7, 'RJ': 7, 'ES': 7, 'RS': 7, 'PR': 7, 'SC': 7, 'DF': 7, 'GO': 7, 'MT': 7, 'MS': 7, 'AC': 7, 'AL': 7, 'AM': 7, 'AP': 7, 'BA': 7, 'CE': 7, 'MA': 7, 'PB': 7, 'PE': 7, 'PI': 7, 'RN': 7, 'RO': 7, 'RR': 7, 'SE': 7, 'TO': 7 },
            'PB': { 'SP': 7, 'MG': 7, 'RJ': 7, 'ES': 7, 'RS': 7, 'PR': 7, 'SC': 7, 'DF': 7, 'GO': 7, 'MT': 7, 'MS': 7, 'AC': 7, 'AL': 7, 'AM': 7, 'AP': 7, 'BA': 7, 'CE': 7, 'MA': 7, 'PA': 7, 'PE': 7, 'PI': 7, 'RN': 7, 'RO': 7, 'RR': 7, 'SE': 7, 'TO': 7 },
            'PE': { 'SP': 7, 'MG': 7, 'RJ': 7, 'ES': 7, 'RS': 7, 'PR': 7, 'SC': 7, 'DF': 7, 'GO': 7, 'MT': 7, 'MS': 7, 'AC': 7, 'AL': 7, 'AM': 7, 'AP': 7, 'BA': 7, 'CE': 7, 'MA': 7, 'PA': 7, 'PB': 7, 'PI': 7, 'RN': 7, 'RO': 7, 'RR': 7, 'SE': 7, 'TO': 7 },
            'PI': { 'SP': 7, 'MG': 7, 'RJ': 7, 'ES': 7, 'RS': 7, 'PR': 7, 'SC': 7, 'DF': 7, 'GO': 7, 'MT': 7, 'MS': 7, 'AC': 7, 'AL': 7, 'AM': 7, 'AP': 7, 'BA': 7, 'CE': 7, 'MA': 7, 'PA': 7, 'PB': 7, 'PE': 7, 'RN': 7, 'RO': 7, 'RR': 7, 'SE': 7, 'TO': 7 },
            'RN': { 'SP': 7, 'MG': 7, 'RJ': 7, 'ES': 7, 'RS': 7, 'PR': 7, 'SC': 7, 'DF': 7, 'GO': 7, 'MT': 7, 'MS': 7, 'AC': 7, 'AL': 7, 'AM': 7, 'AP': 7, 'BA': 7, 'CE': 7, 'MA': 7, 'PA': 7, 'PB': 7, 'PE': 7, 'PI': 7, 'RO': 7, 'RR': 7, 'SE': 7, 'TO': 7 },
            'RO': { 'SP': 7, 'MG': 7, 'RJ': 7, 'ES': 7, 'RS': 7, 'PR': 7, 'SC': 7, 'DF': 7, 'GO': 7, 'MT': 7, 'MS': 7, 'AC': 7, 'AL': 7, 'AM': 7, 'AP': 7, 'BA': 7, 'CE': 7, 'MA': 7, 'PA': 7, 'PB': 7, 'PE': 7, 'PI': 7, 'RN': 7, 'RR': 7, 'SE': 7, 'TO': 7 },
            'RR': { 'SP': 7, 'MG': 7, 'RJ': 7, 'ES': 7, 'RS': 7, 'PR': 7, 'SC': 7, 'DF': 7, 'GO': 7, 'MT': 7, 'MS': 7, 'AC': 7, 'AL': 7, 'AM': 7, 'AP': 7, 'BA': 7, 'CE': 7, 'MA': 7, 'PA': 7, 'PB': 7, 'PE': 7, 'PI': 7, 'RN': 7, 'RO': 7, 'SE': 7, 'TO': 7 },
            'SE': { 'SP': 7, 'MG': 7, 'RJ': 7, 'ES': 7, 'RS': 7, 'PR': 7, 'SC': 7, 'DF': 7, 'GO': 7, 'MT': 7, 'MS': 7, 'AC': 7, 'AL': 7, 'AM': 7, 'AP': 7, 'BA': 7, 'CE': 7, 'MA': 7, 'PA': 7, 'PB': 7, 'PE': 7, 'PI': 7, 'RN': 7, 'RO': 7, 'RR': 7, 'TO': 7 },
            'TO': { 'SP': 7, 'MG': 7, 'RJ': 7, 'ES': 7, 'RS': 7, 'PR': 7, 'SC': 7, 'DF': 7, 'GO': 7, 'MT': 7, 'MS': 7, 'AC': 7, 'AL': 7, 'AM': 7, 'AP': 7, 'BA': 7, 'CE': 7, 'MA': 7, 'PA': 7, 'PB': 7, 'PE': 7, 'PI': 7, 'RN': 7, 'RO': 7, 'RR': 7, 'SE': 7 }
        };

        const aliquotasInternas = {
            'SP': 18, 'MG': 18, 'RJ': 20, 'ES': 17, 'RS': 18, 'PR': 18, 'SC': 17, 
            'DF': 18, 'GO': 17, 'MT': 17, 'MS': 17, 'AC': 17, 'AL': 18, 'AM': 18, 
            'AP': 18, 'BA': 18, 'CE': 18, 'MA': 18, 'PA': 17, 'PB': 18, 'PE': 18, 
            'PI': 18, 'RN': 18, 'RO': 17.5, 'RR': 17, 'SE': 18, 'TO': 18
        };

        const fundoPobreza = {
            'SP': 0, 'MG': 0, 'RJ': 0, 'ES': 0, 'RS': 0, 'PR': 0, 'SC': 0,
            'DF': 0, 'GO': 0, 'MT': 0, 'MS': 0, 'AC': 0, 'AL': 0, 'AM': 0,
            'AP': 0, 'BA': 0, 'CE': 0, 'MA': 0, 'PA': 0, 'PB': 0, 'PE': 0,
            'PI': 0, 'RN': 0, 'RO': 0, 'RR': 0, 'SE': 0, 'TO': 0
        };

        // Estados brasileiros
        const estados = [
            'AC', 'AL', 'AP', 'AM', 'BA', 'CE', 'DF', 'ES', 'GO', 'MA', 
            'MT', 'MS', 'MG', 'PA', 'PB', 'PR', 'PE', 'PI', 'RJ', 'RN', 
            'RS', 'RO', 'RR', 'SC', 'SP', 'SE', 'TO'
        ];

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            popularSelects();
            criarTabelas();
            configurarUpload();
        });

        function popularSelects() {
            const ufOrigem = document.getElementById('ufOrigem');
            const ufDestino = document.getElementById('ufDestino');
            
            estados.forEach(uf => {
                ufOrigem.appendChild(new Option(uf, uf));
                ufDestino.appendChild(new Option(uf, uf));
            });
        }

        function criarTabelas() {
            // Tabela interestadual
            let htmlInterestadual = `
                <table>
                    <thead>
                        <tr>
                            <th>Origem/Destino</th>
                            <th>Alíquota</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            Object.keys(aliquotasInterestaduais.SP).forEach(destino => {
                htmlInterestadual += `
                    <tr>
                        <td>SP → ${destino}</td>
                        <td>${aliquotasInterestaduais.SP[destino]}%</td>
                    </tr>
                `;
            });
            
            htmlInterestadual += '</tbody></table>';
            document.getElementById('tabelaInterestadual').innerHTML = htmlInterestadual;
            
            // Tabela interna
            let htmlInterna = `
                <table>
                    <thead>
                        <tr>
                            <th>UF</th>
                            <th>Alíquota Interna</th>
                            <th>FCP</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            estados.forEach(uf => {
                htmlInterna += `
                    <tr>
                        <td>${uf}</td>
                        <td>${aliquotasInternas[uf]}%</td>
                        <td>${fundoPobreza[uf]}%</td>
                    </tr>
                `;
            });
            
            htmlInterna += '</tbody></table>';
            document.getElementById('tabelaInterna').innerHTML = htmlInterna;
        }

        function configurarUpload() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('xmlUpload');
            
            uploadArea.addEventListener('click', () => fileInput.click());
            
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.style.background = '#e3f2fd';
                uploadArea.style.borderColor = '#2196f3';
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.style.background = '';
                uploadArea.style.borderColor = '#3498db';
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.style.background = '';
                uploadArea.style.borderColor = '#3498db';
                
                const files = e.dataTransfer.files;
                processarArquivos(files);
            });
            
            fileInput.addEventListener('change', (e) => {
                processarArquivos(e.target.files);
            });
        }

        function processarArquivos(files) {
            const listaArquivos = document.getElementById('listaArquivos');
            listaArquivos.innerHTML = '';
            
            Array.from(files).forEach(file => {
                if (file.name.endsWith('.xml')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        processarXML(e.target.result, file.name);
                    };
                    reader.readAsText(file);
                }
            });
        }

        function processarXML(xmlContent, fileName) {
            // Simulação de processamento de XML
            // Em um sistema real, você usaria um parser XML
            const listaArquivos = document.getElementById('listaArquivos');
            
            const arquivoItem = document.createElement('div');
            arquivoItem.className = 'arquivo-item';
            arquivoItem.innerHTML = `
                <strong>${fileName}</strong>
                <div>Processando XML...</div>
            `;
            
            listaArquivos.appendChild(arquivoItem);
            
            // Simular cálculo (em produção, extrair dados reais do XML)
            setTimeout(() => {
                const resultado = simularCalculoXML();
                arquivoItem.innerHTML = `
                    <strong>${fileName}</strong>
                    <div>UF Origem: ${resultado.origem}</div>
                    <div>UF Destino: ${resultado.destino}</div>
                    <div>Valor: R$ ${resultado.valor.toFixed(2)}</div>
                    <div style="color: #27ae60; font-weight: bold;">DIFAL: R$ ${resultado.difal.toFixed(2)}</div>
                `;
            }, 1000);
        }

        function simularCalculoXML() {
            const origem = estados[Math.floor(Math.random() * estados.length)];
            let destino;
            do {
                destino = estados[Math.floor(Math.random() * estados.length)];
            } while (destino === origem);
            
            const valor = Math.random() * 1000 + 100;
            const difal = calcularDIFALSimulado(origem, destino, valor);
            
            return { origem, destino, valor, difal };
        }

        function calcularDIFALSimulado(origem, destino, valor) {
            const aliqInterestadual = aliquotasInterestaduais[origem]?.[destino] || 12;
            const aliqInterna = aliquotasInternas[destino] || 18;
            return valor * (aliqInterna - aliqInterestadual) / 100;
        }

        function calcularDIFAL() {
            const ufOrigem = document.getElementById('ufOrigem').value;
            const ufDestino = document.getElementById('ufDestino').value;
            const tipoDestinatario = document.getElementById('tipoDestinatario').value;
            const valorOperacao = parseFloat(document.getElementById('valorOperacao').value);
            
            // Esconder resultados anteriores
            document.getElementById('resultado').style.display = 'none';
            document.getElementById('isencao').style.display = 'none';
            
            // Validações
            if (!ufOrigem || !ufDestino || !valorOperacao) {
                alert('Por favor, preencha todos os campos obrigatórios.');
                return;
            }
            
            if (valorOperacao <= 0) {
                alert('O valor da operação deve ser maior que zero.');
                return;
            }
            
            // Verificar se DIFAL é aplicável
            if (!verificarAplicabilidade(ufOrigem, ufDestino, tipoDestinatario)) {
                return;
            }
            
            // Calcular DIFAL
            const aliqInterestadual = aliquotasInterestaduais[ufOrigem]?.[ufDestino] || 12;
            const aliqInterna = aliquotasInternas[ufDestino] || 18;
            const fcp = fundoPobreza[ufDestino] || 0;
            
            const difal = valorOperacao * (aliqInterna - aliqInterestadual) / 100;
            const fcpValor = valorOperacao * fcp / 100;
            const total = difal + fcpValor;
            
            // Exibir resultado
            exibirResultado(ufOrigem, ufDestino, valorOperacao, aliqInterestadual, aliqInterna, fcp, difal, fcpValor, total);
        }

        function verificarAplicabilidade(origem, destino, tipoDestinatario) {
            const isencaoDiv = document.getElementById('isencao');
            const motivoIsencao = document.getElementById('motivoIsencao');
            
            // Mesmo estado
            if (origem === destino) {
                isencaoDiv.style.display = 'block';
                motivoIsencao.textContent = 'Operação interna (mesmo estado) - DIFAL não se aplica.';
                return false;
            }
            
            // Destinatário é contribuinte do ICMS
            if (tipoDestinatario === 'contribuinte') {
                isencaoDiv.style.display = 'block';
                motivoIsencao.textContent = 'Destinatário é contribuinte do ICMS - DIFAL não se aplica.';
                return false;
            }
            
            return true;
        }

        function exibirResultado(origem, destino, valor, aliqInter, aliqInt, fcp, difal, fcpValor, total) {
            const resultadoDiv = document.getElementById('resultado');
            const detalhesDiv = document.getElementById('detalhesCalculo');
            
            detalhesDiv.innerHTML = `
                <div class="detalhes-item">
                    <span>Valor da Operação:</span>
                    <span>R$ ${valor.toFixed(2)}</span>
                </div>
                <div class="detalhes-item">
                    <span>Alíquota Interestadual (${origem} → ${destino}):</span>
                    <span>${aliqInter}%</span>
                </div>
                <div class="detalhes-item">
                    <span>Alíquota Interna (${destino}):</span>
                    <span>${aliqInt}%</span>
                </div>
                <div class="detalhes-item">
                    <span>Fundo de Combate à Pobreza (${destino}):</span>
                    <span>${fcp}%</span>
                </div>
                <div class="detalhes-item">
                    <span>Base de Cálculo do DIFAL:</span>
                    <span>R$ ${valor.toFixed(2)}</span>
                </div>
                <div class="detalhes-item">
                    <span>DIFAL (${aliqInt}% - ${aliqInter}%):</span>
                    <span>R$ ${difal.toFixed(2)}</span>
                </div>
                ${fcp > 0 ? `
                <div class="detalhes-item">
                    <span>FCP:</span>
                    <span>R$ ${fcpValor.toFixed(2)}</span>
                </div>
                ` : ''}
                <div class="detalhes-total">
                    <span>Total a Recolher:</span>
                    <span>R$ ${total.toFixed(2)}</span>
                </div>
                <div style="margin-top: 15px; padding: 10px; background: #d1ecf1; border-radius: 5px;">
                    <small>💡 Recolhimento via GNRE para o estado de ${destino}</small>
                </div>
            `;
            
            resultadoDiv.style.display = 'block';
        }
    </script>
</body>
</html>
